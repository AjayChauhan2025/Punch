<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI Image Maker — Prompt → Image</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, 'Helvetica Neue', Arial, 'Noto Sans', 'Apple Color Emoji', 'Segoe UI Emoji';
        }

        .card {
            box-shadow: 0 10px 25px rgba(0,0,0,.08);
            border-radius: 1.25rem;
            background: #fff;
            padding: 1rem;
        }

        .btn {
            padding: 0.5rem 1rem;
            border-radius: 1rem;
            font-weight: 600;
            cursor: pointer;
            display: inline-block;
            transition: all 0.2s ease;
        }

        .btn-primary {
            background: black;
            color: white;
        }

            .btn-primary:hover {
                background: #333;
            }

            .btn-primary:active {
                transform: scale(0.98);
            }

        .btn-ghost {
            background: white;
            color: #333;
            border: 1px solid #ccc;
        }

            .btn-ghost:hover {
                background: #f9f9f9;
            }

        .badge {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 9999px;
            background: #f3f3f3;
            border: 1px solid #ddd;
            display: inline-block;
        }

        .spin {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }
    </style>

</head>
<body class="bg-gradient-to-b from-gray-50 to-white text-gray-900">
  <div class="max-w-6xl mx-auto p-6 md:p-10">
    <header class="flex flex-col md:flex-row md:items-end md:justify-between gap-4 mb-6">
      <div>
        <h1 class="text-3xl md:text-4xl font-extrabold tracking-tight">AI Image Maker</h1>
        <p class="text-gray-600 mt-1">Prompt લખો → Image મેળવો. Size બદલો, download કરો. (No server required for demo provider)</p>
      </div>
      <div class="flex items-center gap-3">
        <span class="badge">Client-only</span>
        <span class="badge">Resize & Download</span>
      </div>
    </header>

    <!-- Controls Card -->
    <section class="card bg-white p-6 md:p-8">
      <div class="grid md:grid-cols-5 gap-4 md:gap-6">
        <div class="md:col-span-3">
          <label class="block text-sm font-medium text-gray-700 mb-2">Prompt</label>
          <textarea id="prompt" class="w-full rounded-xl border border-gray-300 p-3 focus:outline-none focus:ring-2 focus:ring-black" rows="3" placeholder="e.g., ‘a cute chubby girl with long braids, standing outside home, holding a bag, 3D Pixar style’"></textarea>
          <div class="flex items-center gap-2 mt-2">
            <button id="ex1" class="btn btn-ghost text-sm">Use Example 1</button>
            <button id="ex2" class="btn btn-ghost text-sm">Use Example 2</button>
          </div>
        </div>

        <div class="md:col-span-2 grid grid-cols-2 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Preset Size</label>
            <select id="presetSize" class="w-full rounded-xl border border-gray-300 p-2.5 focus:outline-none focus:ring-2 focus:ring-black">
              <option value="512x512">512 × 512</option>
              <option value="768x768">768 × 768</option>
              <option value="1024x1024" selected>1024 × 1024</option>
              <option value="custom">Custom…</option>
            </select>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Count</label>
            <input id="count" type="number" min="1" max="4" value="1" class="w-full rounded-xl border border-gray-300 p-2.5 focus:outline-none focus:ring-2 focus:ring-black" />
          </div>

          <div class="col-span-2 hidden" id="customSizeRow">
            <div class="grid grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Width (px)</label>
                <input id="width" type="number" value="1024" min="64" max="2048" class="w-full rounded-xl border border-gray-300 p-2.5 focus:outline-none focus:ring-2 focus:ring-black" />
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Height (px)</label>
                <input id="height" type="number" value="1024" min="64" max="2048" class="w-full rounded-xl border border-gray-300 p-2.5 focus:outline-none focus:ring-2 focus:ring-black" />
              </div>
            </div>
            <p class="text-xs text-gray-500 mt-2">Tip: Large sizes may take longer to load.</p>
          </div>

          <div class="col-span-2 flex items-end gap-3">
            <button id="generateBtn" class="btn btn-primary flex items-center gap-2">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-5 h-5"><path d="M11.725 2.836a.75.75 0 0 1 .55 0l8.25 3.3a.75.75 0 0 1 0 1.387l-8.25 3.3a.75.75 0 0 1-.55 0l-8.25-3.3a.75.75 0 0 1 0-1.387l8.25-3.3Z"/><path d="M3 10.5l8.25 3.3a.75.75 0 0 0 .55 0L20.5 10.5v6.75a.75.75 0 0 1-.477.698l-8.25 3.3a.75.75 0 0 1-.546 0l-8.25-3.3A.75.75 0 0 1 3 17.25V10.5Z"/></svg>
              Generate</button>
            <button id="clearBtn" class="btn btn-ghost">Clear</button>
          </div>
        </div>
      </div>

      <details class="mt-6">
        <summary class="cursor-pointer text-sm text-gray-700">Advanced: Provider Settings</summary>
        <div class="mt-4 grid md:grid-cols-3 gap-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Provider</label>
            <select id="provider" class="w-full rounded-xl border border-gray-300 p-2.5 focus:outline-none focus:ring-2 focus:ring-black">
              <option value="pollinations" selected>Pollinations (no key, demo)</option>
              <option value="openai_direct">OpenAI — images/generations (exposes key)</option>
              <option value="custom_proxy">Custom Proxy (recommended)</option>
            </select>
            <p class="text-xs text-gray-500 mt-2">Use <b>Pollinations</b> to test without any API key. For production, set up a server proxy and choose <b>Custom Proxy</b>.</p>
          </div>
          <div id="apiKeyWrap" class="hidden">
            <label class="block text-sm font-medium text-gray-700 mb-2">API Key</label>
            <input id="apiKey" type="password" placeholder="sk-..." class="w-full rounded-xl border border-gray-300 p-2.5 focus:outline-none focus:ring-2 focus:ring-black" />
            <p class="text-xs text-amber-600 mt-2">Warning: Using keys in the browser exposes them. Prefer <b>Custom Proxy</b>.</p>
          </div>
          <div id="endpointWrap" class="hidden">
            <label class="block text-sm font-medium text-gray-700 mb-2">Proxy Endpoint URL</label>
            <input id="endpoint" type="text" placeholder="https://your-domain.com/api/generate" class="w-full rounded-xl border border-gray-300 p-2.5 focus:outline-none focus:ring-2 focus:ring-black" />
            <p class="text-xs text-gray-500 mt-2">Your server should accept JSON { prompt, width, height, count } and return an array of image URLs or base64 strings.</p>
          </div>
        </div>
      </details>
    </section>

    <!-- Results -->
    <section class="mt-8">
      <div id="status" class="hidden items-center gap-2 text-sm text-gray-600">
        <svg class="w-4 h-4 spin" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path></svg>
        <span id="statusText">Generating…</span>
      </div>
      <div id="gallery" class="grid sm:grid-cols-2 lg:grid-cols-3 gap-6 mt-4"></div>
    </section>

    <footer class="mt-10 text-xs text-gray-500">
      <p>Note: Some providers return images without CORS headers; in those cases, in-browser pixel-resize & re-download may be blocked by the browser’s security. You can still view & CSS-resize, or use a proxy to add proper CORS headers for editing.</p>
    </footer>
  </div>

  <template id="imgCardTpl">
    <div class="card bg-white overflow-hidden">
      <div class="aspect-square bg-gray-100 flex items-center justify-center overflow-hidden">
        <img class="w-full h-full object-contain" crossorigin="anonymous" />
      </div>
      <div class="p-4 border-t border-gray-100 space-y-3">
        <div class="flex items-center justify-between">
          <span class="text-xs text-gray-500"><span class="wVal">—</span> × <span class="hVal">—</span> px</span>
          <div class="flex gap-2">
            <button class="btn btn-ghost text-xs downloadBtn">Download</button>
            <button class="btn btn-ghost text-xs copyLinkBtn">Copy Link</button>
          </div>
        </div>
        <div class="grid grid-cols-3 gap-2">
          <input class="resizeW w-full rounded-xl border border-gray-300 p-2 text-sm" type="number" min="32" value="1024" />
          <input class="resizeH w-full rounded-xl border border-gray-300 p-2 text-sm" type="number" min="32" value="1024" />
          <button class="btn btn-primary text-xs resizeBtn">Resize</button>
        </div>
        <p class="text-[11px] text-gray-500">If resize fails, provider likely blocked canvas (CORS). Use proxy mode.</p>
      </div>
    </div>
  </template>

  <script>
    const $ = (s, p=document) => p.querySelector(s);
    const $$ = (s, p=document) => Array.from(p.querySelectorAll(s));

    const promptEl = $('#prompt');
    const presetSizeEl = $('#presetSize');
    const customSizeRow = $('#customSizeRow');
    const widthEl = $('#width');
    const heightEl = $('#height');
    const countEl = $('#count');
    const providerEl = $('#provider');
    const apiKeyWrap = $('#apiKeyWrap');
    const apiKeyEl = $('#apiKey');
    const endpointWrap = $('#endpointWrap');
    const endpointEl = $('#endpoint');

    const statusWrap = $('#status');
    const statusText = $('#statusText');
    const gallery = $('#gallery');

    $('#ex1').addEventListener('click', () => {
      promptEl.value = 'Cute chubby Gujarati girl with long braids, standing outside home holding a bag, ready for vegetable market, 3D Pixar style, vibrant soft light';
    });
    $('#ex2').addEventListener('click', () => {
      promptEl.value = 'Realistic fresh vegetable market scene in India, colorful stalls, soft morning light, cinematic depth of field';
    });

    presetSizeEl.addEventListener('change', () => {
      if (presetSizeEl.value === 'custom') customSizeRow.classList.remove('hidden');
      else {
        customSizeRow.classList.add('hidden');
        const [w, h] = presetSizeEl.value.split('x').map(Number);
        widthEl.value = w; heightEl.value = h;
      }
    });

    providerEl.addEventListener('change', () => {
      const p = providerEl.value;
      apiKeyWrap.classList.toggle('hidden', p !== 'openai_direct');
      endpointWrap.classList.toggle('hidden', p !== 'custom_proxy');
    });

    $('#clearBtn').addEventListener('click', () => {
      promptEl.value = '';
      gallery.innerHTML = '';
    });

    $('#generateBtn').addEventListener('click', async () => {
      const prompt = promptEl.value.trim();
      if (!prompt) { alert('Please enter a prompt.'); return; }

      const count = Math.max(1, Math.min(4, Number(countEl.value)||1));
      const w = Math.max(64, Math.min(2048, Number(widthEl.value)||1024));
      const h = Math.max(64, Math.min(2048, Number(heightEl.value)||1024));

      gallery.innerHTML = '';
      statusWrap.classList.remove('hidden');
      statusText.textContent = 'Generating…';

      try {
        const urls = await generateImages({ prompt, count, width: w, height: h });
        statusText.textContent = 'Rendering…';
        for (const url of urls) {
          addImageCard(url, w, h);
        }
      } catch (err) {
        console.error(err);
        alert('Generation failed: ' + (err?.message || err));
      } finally {
        statusWrap.classList.add('hidden');
      }
    });

    async function generateImages({ prompt, count, width, height }) {
      const provider = providerEl.value;

      if (provider === 'pollinations') {
        // Pollinations public endpoint (no key). Adds width/height; may not send CORS headers.
        // We use distinct seeds for multiple images using a simple counter.
        const base = 'https://image.pollinations.ai/prompt/';
        const urls = Array.from({ length: count }, (_, i) => {
          const seed = encodeURIComponent(prompt + ' ::seed ' + Date.now() + '-' + i);
          return `${base}${seed}?width=${width}&height=${height}`;
        });
        return urls;
      }

      if (provider === 'openai_direct') {
        const key = apiKeyEl.value.trim();
        if (!key) throw new Error('Enter your OpenAI API key.');
        // Direct call to OpenAI Images API (exposes key in browser — use only for testing!)
        const resp = await fetch('https://api.openai.com/v1/images/generations', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${key}`
          },
          body: JSON.stringify({
            model: 'gpt-image-1', // image generation model
            prompt,
            n: count,
            size: `${width}x${height}`
          })
        });
        if (!resp.ok) throw new Error('OpenAI error: ' + resp.status);
        const data = await resp.json();
        // API returns base64 URLs or URL links depending on account; normalize to data URLs if needed
        const urls = data.data.map(d => d.url || ('data:image/png;base64,' + d.b64_json));
        return urls;
      }

      if (provider === 'custom_proxy') {
        const endpoint = endpointEl.value.trim();
        if (!endpoint) throw new Error('Enter your proxy endpoint URL.');
        const resp = await fetch(endpoint, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ prompt, width, height, count })
        });
        if (!resp.ok) throw new Error('Proxy error: ' + resp.status);
        const data = await resp.json();
        // Expecting: { images: [urlOrBase64, ...] }
        return data.images || [];
      }

      throw new Error('Unknown provider.');
    }

    function addImageCard(src, w, h) {
      const tpl = $('#imgCardTpl');
      const node = tpl.content.firstElementChild.cloneNode(true);
      const img = $('img', node);
      const wVal = $('.wVal', node);
      const hVal = $('.hVal', node);
      const resizeW = $('.resizeW', node);
      const resizeH = $('.resizeH', node);
      const resizeBtn = $('.resizeBtn', node);
      const downloadBtn = $('.downloadBtn', node);
      const copyLinkBtn = $('.copyLinkBtn', node);

      img.src = src;
      img.addEventListener('load', () => {
        wVal.textContent = img.naturalWidth; hVal.textContent = img.naturalHeight;
        resizeW.value = img.naturalWidth; resizeH.value = img.naturalHeight;
      });

      copyLinkBtn.addEventListener('click', async () => {
        try { await navigator.clipboard.writeText(src); alert('Link copied.'); } catch {}
      });

      downloadBtn.addEventListener('click', async () => {
        // If it's a data URL, download directly; else fetch as blob
        try {
          let blob;
          if (src.startsWith('data:image')) {
            const res = await fetch(src);
            blob = await res.blob();
          } else {
            const res = await fetch(src, { mode: 'cors' });
            blob = await res.blob();
          }
          const a = document.createElement('a');
          a.href = URL.createObjectURL(blob);
          a.download = `image-${Date.now()}.png`;
          a.click();
          URL.revokeObjectURL(a.href);
        } catch (e) {
          alert('Direct download blocked. Right-click → Save Image As… or use proxy.');
        }
      });

      resizeBtn.addEventListener('click', async () => {
        const targetW = Math.max(32, Math.min(4096, Number(resizeW.value)||512));
        const targetH = Math.max(32, Math.min(4096, Number(resizeH.value)||512));
        try {
          const dataUrl = await resizeImageToDataURL(img, targetW, targetH);
          // Swap preview to resized version
          img.src = dataUrl;
          wVal.textContent = targetW; hVal.textContent = targetH;
        } catch (e) {
          alert('Resize failed (likely CORS). Use Custom Proxy mode to enable editing.');
        }
      });

      gallery.appendChild(node);
    }

    async function resizeImageToDataURL(imgEl, w, h) {
      // Draw image into canvas (requires image to be CORS-accessible)
      const canvas = document.createElement('canvas');
      canvas.width = w; canvas.height = h;
      const ctx = canvas.getContext('2d');
      // Optional: high quality scaling
      ctx.imageSmoothingEnabled = true;
      ctx.imageSmoothingQuality = 'high';
      ctx.drawImage(imgEl, 0, 0, w, h);
      return canvas.toDataURL('image/png');
    }

    // Initialize default preset
    (function init() {
      const [w, h] = presetSizeEl.value.split('x').map(Number);
      widthEl.value = w; heightEl.value = h;
    })();
  </script>
</body>
</html>
